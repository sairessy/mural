<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" href="/assets/img/m.png" />
		<title>Mural - O seu mural virtual</title>
		<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/line-awesome/1.3.0/line-awesome/css/line-awesome.min.css" integrity="sha512-vebUliqxrVkBy3gucMhClmyQP9On/HAWQdKDXRaAlb/FKuTbxkjPKUyqVOxAcGwFDka79eTF+YXwfke1h3/wfg==" crossorigin="anonymous" referrerpolicy="no-referrer" /> -->
		<link rel="stylesheet" href="/css/global.css" />
		<style>
			body {
				padding: 0;
				margin: 0;
				background-color: #eee;
			}

			#scanner {
				position: fixed;
				background-color: #fff;
				top: 0;
				left: 0;
				width: 100%;
				height: 100vh;
				/* display: flex; */
				/* flex-direction: column;
				justify-content: center; */
				z-index: 5;
				display: none;
			}

			#scanner button {
				position: absolute;
				margin: 0;
				margin-bottom: 10px;
				padding: 5px;
				color: #000;
				background-color: #ddd;
				display: inline-block;
				width: calc(100% - 0px);
			}

			section {
				background-color: #fff;
				width: 75%;
				margin: auto;
				box-shadow: 0 0 2px 2px #ddd;
				min-height: 100vh;
			}

			#header {
				border-bottom: 1px solid #ddd;
				box-shadow: 0 2px 4px 4px #eee;
				display: flex;
				align-items: center;
				height: 30px;
				padding: 10px;
				justify-content: space-between;
				background-color: #ffffff;
				border-top: 15px solid #000;
			}

			#header .search-container {
				flex: 1;
				display: flex;
			}

			#header .search-container #btn-search-vitrola {
				width: 240px;
				padding: 12px;
				margin-left: 10px;
				background: url(assets/img/search-light.svg) no-repeat 15px center/25px;
				background-color: #000000;
				border: none;
				font-size: 14px;
				border-radius: 5px;
				color: #fff;
				cursor: pointer;
				display: none;
			}

			#btn-scanqr {
				display: inline-block;
				width: 60px;
				height: 30px;
				background: url(assets/img/qrcode-black.svg) no-repeat center
					center/30px;
				border-radius: 5px;
				margin-left: 20px;
				display: none;
			}

			#header nav a {
				margin-left: 10px;
			}

			#a-login {
				padding: 10px;
				border-radius: 3px;
				display: inline-block;
				width: 140px;
				text-align: center;
				box-shadow: 0 0 1px 1px #ddd;
				color: #000;
			}

			#form-search {
				display: none;
			}

			#inp-search-vitrola {
				display: inline-block;
				width: 100%;
				margin-left: 20px;
				padding: 12px;
				font-size: 14px;
				outline: none;
				bottom: none;
				border: 1px solid #ddd;
				background: url(assets/img/search-solid.svg) no-repeat 10px center/20px;
				background-color: #fff;
				border-radius: 5px;
				padding-left: 40px;
			}

			#banner {
				background-color: #000;
				height: 320px;
				-moz-box-shadow: inset 10px 10px 50px #000;
				-webkit-box-shadow: inset 10px 10px 50px #000;
				box-shadow: inset 10px 10px 50px #000;
				background: url(assets/img/bn.jpg) no-repeat center center/cover;
			}

			#banner-cover {
				display: flex;
				justify-content: center;
				align-items: center;
				flex-direction: column;
				height: 320px;
				background: #0000007a;
				position: relative;
			}

			#banner-cover .contact {
				display: flex;
				position: absolute;
				bottom: -20px;
				right: 10px;
			}

			.contact a {
				display: flex;
				align-items: center;
				padding: 0 5px;
				border-radius: 5px;
				border-radius: 4px;
				background-color: #075e54;
				box-shadow: 1px 1px 1px 1px #000;
				color: #fff;
				margin-left: 10px;
			}

			.contact img {
				border-right: 1px dashed #000;
				width: 25px;
				height: 25px;
				padding-right: 5px;
				margin-right: 5px;
				padding: 10px;
			}
			.contact span {
				width: 120px;
				text-align: center;
			}

			#banner #banner-cover p {
				text-align: center;
				margin-top: 20px;
			}

			#banner #banner-cover p a {
				color: #aaa;
				font-size: 22px;
				text-decoration: underline;
			}

			#main {
				min-height: 100vh;
			}

			#form-filter {
				width: 90%;
				display: none;
			}

			#form-filter #inp-org-name {
				padding: 15px;
				background-color: #00000094;
				border-radius: 5px;
				border: none;
				display: block;
				width: 100%;
				color: #fff;
				margin: auto;
				font-size: 18px;
				transition: all 0.3s ease;
				opacity: 0.9;
			}

			#form-filter #inp-org-name:focus {
				opacity: 1;
			}

			.vitrola {
				padding: 5px 20px;
				margin-bottom: 20px;
			}

			.doc {
				display: flex;
				align-items: center;
			}

			.doc p {
				margin-left: 20px;
				margin-bottom: 20px;
				display: flex;
				flex-direction: column;
			}

			.doc p a img {
				margin-right: 10px;
			}

			.doc p a span {
				text-decoration: underline;
				color: #000;
			}

			.doc p a {
				display: flex;
				align-items: center;
				margin-bottom: 10px;
			}

			.doc p small {
				color: #777;
				margin-left: 30px;
			}

			.p-no-docs {
				color: #777;
				margin-left: 10px;
			}

			h4 {
				/* background-color: #eee;
			box-shadow: inset 1px 1px 2px #ddd; */
				background-color: #f9f9f9;
				border-radius: 5px;
				padding: 10px;
				color: #666;
				display: flex;
				align-items: center;
				margin: 10px;
				margin-top: 25px;
			}

			h4 p {
				text-transform: uppercase;
				margin-left: 10px;
				font-size: 16px;
			}

			h4 small {
				margin-left: 10px;
				margin-right: 10px;
				color: #999;
				display: inline-block;
				width: 140px;
				text-align: center;
			}

			h4 button {
				margin-left: 10px;
				border-radius: 3px;
				padding: 4px;
				background-color: #000;
				display: flex;
				align-items: center;
			}

			h4 button img {
				margin-right: 5px;
			}

			.doc-buttons {
				margin-left: 10px;
			}

			#footer {
				height: 60px;
				border-top: 1px solid #ddd;
				display: flex;
				justify-content: center;
				align-items: center;
				color: #666;
				background-color: #f9f9f9;
			}

			/* Smartfones */
			@media screen and (max-width: 414px) {
				#header {
					height: 20px;
					border-top: 0;
				}

				section {
					width: 100%;
					box-shadow: none;
				}

				#header .search-container #btn-search-vitrola {
					width: fit-content;
					width: 50px;
					height: 40px;
					background-position: center;
				}

				#header .search-container #btn-search-vitrola span {
					display: none;
				}

				#btn-scanqr {
					display: inline-block;
					margin-left: 5px;
				}

				#form-search {
					display: none;
				}

				#a-login {
					padding: 5px;
					width: 70px;
				}

				#banner,
				#banner-cover {
					height: 160px;
				}

				#banner #banner-cover p a {
					font-size: 14px;
				}

				#banner-cover .contact {
					left: 0;
					border-radius: 1px;
				}

				#banner-cover .contact a {
					border-radius: 5px;
				}

				.contact img {
					padding: 5px;
				}
				.contact span {
					width: auto;
					text-align: center;
				}

				h4 {
					flex-wrap: wrap;
					margin-top: 25px;
				}

				h4 button {
					margin-left: 0;
				}

				h4 button img {
					margin-right: 0;
				}

				h4 button span {
					display: none;
				}

				h4 p {
					text-transform: uppercase;
					margin-left: 10px;
					font-size: 12px;
				}
			}

			/* Tablets */
			@media screen and (min-width: 414px) and (max-width: 768px) {
				section {
					width: 100%;
				}

				#btn-scanqr {
					display: inline-block;
				}

				h4 button img {
					margin-right: 0;
				}

				h4 button span {
					display: none;
				}
			}
		</style>
	</head>
	<body>
		<main>
			<section>
				<div id="header">
					<h1 class="app-title">
						<img width="30" height="30" src="assets/img/m.png" /><a href="/"
							>MURAL</a
						>
					</h1>
					<div class="search-container">
						<form action="#" id="form-search">
							<input
								type="text"
								placeholder="Pesquisar"
								id="inp-search-vitrola"
							/>
						</form>
						<button id="btn-search-vitrola">
							<span>Pesquisar Mural por ID</span>
						</button>
						<button id="btn-scanqr"></button>
					</div>
					<nav>
						<a href="/login" id="a-login">Criar</a>
					</nav>
				</div>

				<div id="main">
					<div id="banner">
						<div id="banner-cover">
							<div class="contact">
								<a href="https://wa.me/+258847460853"
									><img src="assets/img/whatsapp.svg" />
									<span>Contacte-nos</span>
								</a>
							</div>
							<form action="#" id="form-filter">
								<input
									type="search"
									id="inp-org-name"
									placeholder="Nome da organização, escritório ou mural"
								/>
							</form>
							<p>
								<a href="/dashboard"
									>Crie murais virtuais para a sua organização!</a
								>
							</p>
						</div>
					</div>

					<div id="vitrolas-all">
						<div id="vitrolas"></div>
					</div>
				</div>

				<div id="footer">
					<p>Mural, inc &copy; 2022</p>
				</div>
			</section>
		</main>

		<div id="scanner">
			<button id="btn-close-scanner">Fechar</button>
			<div id="reader"></div>
		</div>
	</body>

	<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
	<script src="js/config.js"></script>
	<script>
		getVitrolas();
		async function getVitrolas() {
			const resp = await fetch("/vitrolas");
			const json = await resp.json();
			let vitrolas = "";

			json.forEach((v) => {
				let docs = "";

				if (v.docs.length > 0) {
					for (let i = 0; i < v.docs.length; i++) {
						const d = v.docs[i];
						if (!d.removed) {
							docs += `
							<div class="doc">
								<p>
									<a target="_blank" href="/download/${d.time}">
										<img width="20" height="20" src="assets/img/file-pdf.svg" />
										<span>${d.title}</span>
									</a>
									<small>${new Date(parseInt(d.time)).toDateString()}</small>
								</p>
								<div class="doc-buttons"></div>
							</div>
						`;
						}
					}
				}

				vitrolas += `
				<h4>
					<!--<button onClick="sendNotification('${v._id}');">
						<img width="15" height="15" src="assets/img/bell.svg" />
						<span>Notificar-me</span>
					</button>-->
					<button id="btn-copy-link" onClick="copyLink('${v._id}');">
						<img width="15" height="15" src="assets/img/copy.svg" />
						<span>Copiar link</span>
					</button>
					<p>${v.name} &ast; ${v.userOffice}</p>
				</h4>
				<div class="vitrola">
					${docs != "" ? docs : "<p class='p-no-docs'>Nenhum documento neste mural</p>"}
				</div>
			`;

				document.getElementById("vitrolas").innerHTML = vitrolas;
			});
		}

		document
			.getElementById("inp-org-name")
			.addEventListener("keyup", async (e) => {
				const text = e.target.value;
				if (text != "") {
					const resp = await fetch(`/search/${text}`);
					const json = await resp.json();
					console.log(json);
				}
			});

		async function sendNotification(vitrola) {
			const email = prompt("Seu email:");

			const data = { email, vitrola };

			if (email != null) {
				const response = await fetch("/addsubscription", {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify(data),
				});

				const json = await response.json();
				console.log(json);
			}
		}

		async function copyLink(id) {
			alert(CONFIG.site + "/mural/" + id);
		}

		document.getElementById("btn-scanqr").addEventListener("click", () => {
			document.getElementById("scanner").style.display = "flex";
			const onScanSuccess = (decodedText, decodedResult) => {
				// handle the scanned code as you like, for example:
				console.log(`Code matched = ${decodedText}`, decodedResult);
				window.location.href = decodedText;
			};

			const onScanFailure = (error) => {
				// handle scan failure, usually better to ignore and keep scanning.
				// for example:
				console.warn(`Code scan error = ${error}`);
			};

			let html5QrcodeScanner = new Html5QrcodeScanner(
				"reader",
				{ fps: 10, qrbox: { width: 250, height: 250 } },
				/* verbose= */ false
			);
			html5QrcodeScanner.render(onScanSuccess, onScanFailure);
		});

		document
			.getElementById("btn-close-scanner")
			.addEventListener("click", (e) => {
				document.getElementById("scanner").style.display = "none";
			});
	</script>
</html>
